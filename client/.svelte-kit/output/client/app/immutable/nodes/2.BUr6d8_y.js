var Vt=Object.defineProperty;var Lt=(n,e,t)=>e in n?Vt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var G=(n,e,t)=>Lt(n,typeof e!="symbol"?e+"":e,t);import{s as Re,Z as ye,a as w,b as C,d as S,e as K,f as $,g as D,t as X,h as I,B as Xe,k as ge,v as Ve,c as Le,o as dt,_ as ht,r as Ht,n as jt,w as mt}from"../chunks/tEVaBw1t.js";import{S as Fe,i as $e,d as V,e as ne,v as Ie,a as p,f as z,t as U,g as P,s as ve,n as ae,h as fe,j as Q,m as J,b as N,c as v,o as De,k as y,l as ee,p as ke,x as vt}from"../chunks/BGWbKkEQ.js";import{g as Gt}from"../chunks/D0QH3NT1.js";import{d as Wt,w as Pe}from"../chunks/CtoJYVjq.js";import{H as Ft,s as gt,a as _t,u as pt}from"../chunks/BywDTSGp.js";import{s as He}from"../chunks/Cvmz1LN0.js";import{A as Et,I as qe,c as zt,G as Qt,d as bt,W as Jt,e as Zt,f as Kt,M as Xt}from"../chunks/c55LCVDM.js";function Ce(){try{const n=typeof window<"u"&&"__TAURI__"in window&&window.__TAURI__!==null;return console.log("[DEBUG] tauri.ts: isTauri() =",n),console.log("[DEBUG] tauri.ts: typeof window =",typeof window),console.log("[DEBUG] tauri.ts: __TAURI__ in window =",typeof window<"u"&&"__TAURI__"in window),n}catch{return console.log("[DEBUG] tauri.ts: isTauri() caught exception, returning false"),!1}}async function yt(n,e){if(console.log(`[DEBUG] tauri.ts: safeInvoke('${n}') called`),!Ce())return console.warn(`[Tauri] Not in Tauri environment, skipping invoke: ${n}`),null;try{return console.log(`[DEBUG] tauri.ts: Invoking command '${n}' with args:`,e),await window.__TAURI__.invoke(n,e)}catch(t){return console.error(`[Tauri] Failed to invoke ${n}:`,t),null}}function kt(n,e){if(console.log(`[DEBUG] tauri.ts: safeListen('${n}') called`),!Ce())return console.warn(`[Tauri] Not in Tauri environment, skipping event listener: ${n}`),()=>{};try{console.log(`[DEBUG] tauri.ts: Listening to event '${n}'`);const t=window.__TAURI__.event.listen(n,e);return()=>{t.then(s=>s()).catch(s=>console.error(`[Tauri] Failed to unlisten from ${n}:`,s))}}catch(t){return console.error(`[Tauri] Failed to listen to ${n}:`,t),()=>{}}}class Yt{constructor(e={}){G(this,"ws",null);G(this,"url");G(this,"reconnectInterval");G(this,"maxReconnectAttempts");G(this,"reconnectAttempts",0);G(this,"reconnectTimer",null);G(this,"isManualClose",!1);G(this,"lastErrorLogged",0);G(this,"pingInterval",null);G(this,"pingIntervalMs",3e4);G(this,"onOpenCallback",null);G(this,"onCloseCallback",null);G(this,"onErrorCallback",null);G(this,"onMessageCallback",null);this.url=e.url||"ws://localhost:8081/ws",this.reconnectInterval=e.reconnectInterval||5e3,this.maxReconnectAttempts=e.maxReconnectAttempts||10}connect(){this.ws&&this.ws.readyState===WebSocket.OPEN||(this.isManualClose=!1,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("[Socket] Connected to",this.url),this.reconnectAttempts=0,this.startPing(),this.onOpenCallback&&this.onOpenCallback()},this.ws.onclose=e=>{console.log("[Socket] Disconnected",e.code,e.reason),this.stopPing(),this.onCloseCallback&&this.onCloseCallback(),!this.isManualClose&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=e=>{const t=Date.now();t-this.lastErrorLogged>5e3&&(console.warn("[Socket] Connection error (server may be offline)"),this.lastErrorLogged=t),this.onErrorCallback&&this.onErrorCallback(e)},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);if(t.type==="pong"){console.log("[Socket] Pong received");return}this.onMessageCallback&&this.onMessageCallback(t)}catch(t){console.error("[Socket] Failed to parse message:",t)}})}disconnect(){this.isManualClose=!0,this.stopPing(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null)}sendText(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("[Socket] Cannot send message: not connected");return}this.ws.send(e)}sendBinary(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("[Socket] Cannot send binary data: not connected");return}this.ws.send(e)}sendAudio(e){e.arrayBuffer().then(t=>{this.sendBinary(t)})}startPing(){this.stopPing(),this.pingInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e={type:"ping"};this.ws.send(JSON.stringify(e)),console.log("[Socket] Ping sent")}},this.pingIntervalMs)}stopPing(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}scheduleReconnect(){this.reconnectTimer||(this.reconnectAttempts++,console.log(`[Socket] Reconnecting in ${this.reconnectInterval}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=null,this.connect()},this.reconnectInterval))}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}getReadyState(){return this.ws?.readyState??WebSocket.CLOSED}onOpen(e){this.onOpenCallback=e}onClose(e){this.onCloseCallback=e}onError(e){this.onErrorCallback=e}onMessage(e){this.onMessageCallback=e}clearCallbacks(){this.onOpenCallback=null,this.onCloseCallback=null,this.onErrorCallback=null,this.onMessageCallback=null}}function eu(n){return new Yt(n)}const se=eu({url:"ws://localhost:8081/ws",reconnectInterval:5e3,maxReconnectAttempts:10}),be=Pe(!1),we=Pe(""),Ye=Pe(null);Wt(be,n=>n?"connected":"disconnected");se.onOpen(()=>{be.set(!0),Ye.set(null)});se.onClose(()=>{be.set(!1)});se.onError(n=>{Ye.set("Connection error")});se.onMessage(n=>{n.type==="transcription"?we.set(n.text):n.type==="error"&&Ye.set(n.message)});function wt(){se.connect()}function tu(){se.disconnect()}function Ct(n){se.sendAudio(n)}function Dt(){se.clearCallbacks(),se.disconnect()}function uu(){const{subscribe:n,update:e,set:t}=Pe({recordings:[]});return{subscribe:n,addRecording:(s,d)=>{e(o=>({recordings:[{id:crypto.randomUUID(),timestamp:Date.now(),transcription:s,duration:d},...o.recordings]}))},deleteRecording:s=>{e(d=>({recordings:d.recordings.filter(o=>o.id!==s)}))},clearRecordings:()=>{t({recordings:[]})}}}const Bt=uu(),Ee="C:/Users/Евгений/Documents/AlfaVoice/client/src/lib/components/Banner.svelte";function je(n){let e,t,s,d,o,i,m,l,f,u,a,_,r,c,g,E;var B=Et;function q(R,k){return{props:{size:18},$$inline:!0}}B&&(r=ne(B,q()));const O={c:function(){e=D("div"),t=D("div"),s=D("h2"),d=X(n[0]),o=I(),i=D("p"),m=X(n[1]),l=I(),f=D("button"),u=D("span"),a=X(n[2]),_=I(),r&&Q(r.$$.fragment),this.h()},l:function(k){e=C(k,"DIV",{class:!0});var b=S(e);t=C(b,"DIV",{class:!0});var A=S(t);s=C(A,"H2",{class:!0});var h=S(s);d=K(h,n[0]),h.forEach(p),o=$(A),i=C(A,"P",{class:!0});var F=S(i);m=K(F,n[1]),F.forEach(p),A.forEach(p),l=$(b),f=C(b,"BUTTON",{class:!0});var H=S(f);u=C(H,"SPAN",{});var j=S(u);a=K(j,n[2]),j.forEach(p),_=$(H),r&&ee(r.$$.fragment,H),H.forEach(p),b.forEach(p),this.h()},h:function(){y(s,"class","banner-title svelte-198123s"),w(s,Ee,13,2,841),y(i,"class","banner-description svelte-198123s"),w(i,Ee,14,2,881),y(t,"class","banner-content svelte-198123s"),w(t,Ee,12,1,810),w(u,Ee,17,2,1016),y(f,"class","banner-button svelte-198123s"),w(f,Ee,16,1,938),y(e,"class","banner svelte-198123s"),w(e,Ee,11,0,788)},m:function(k,b){N(k,e,b),v(e,t),v(t,s),v(s,d),v(t,o),v(t,i),v(i,m),v(e,l),v(e,f),v(f,u),v(u,a),v(f,_),r&&J(r,f,null),c=!0,g||(E=De(f,"click",n[4],!1,!1,!1),g=!0)},p:function(k,[b]){if((!c||b&1)&&ve(d,k[0]),(!c||b&2)&&ve(m,k[1]),(!c||b&4)&&ve(a,k[2]),B!==(B=Et)){if(r){ae();const A=r;U(A.$$.fragment,1,0,()=>{z(A,1)}),fe()}B?(r=ne(B,q()),Q(r.$$.fragment),P(r.$$.fragment,1),J(r,f,null)):r=null}},i:function(k){c||(r&&P(r.$$.fragment,k),c=!0)},o:function(k){r&&U(r.$$.fragment,k),c=!1},d:function(k){k&&p(e),r&&z(r),g=!1,E()}};return V("SvelteRegisterBlock",{block:O,id:je.name,type:"component",source:"",ctx:n}),O}function nu(n,e,t){let{$$slots:s={},$$scope:d}=e;Ie("Banner",s,[]);const o=ye();let{title:i="Настройте звучание AlfaVoice"}=e,{description:m="Адаптируйте голосовой ввод под ваш стиль письма и профессиональный словарь."}=e,{buttonText:l="Начать"}=e;const f=["title","description","buttonText"];Object.keys(e).forEach(a=>{!~f.indexOf(a)&&a.slice(0,2)!=="$$"&&a!=="slot"&&console.warn(`<Banner> was created with unknown prop '${a}'`)});const u=()=>o("start-recording");return n.$$set=a=>{"title"in a&&t(0,i=a.title),"description"in a&&t(1,m=a.description),"buttonText"in a&&t(2,l=a.buttonText)},n.$capture_state=()=>({createEventDispatcher:ye,Icons:qe,dispatch:o,title:i,description:m,buttonText:l}),n.$inject_state=a=>{"title"in a&&t(0,i=a.title),"description"in a&&t(1,m=a.description),"buttonText"in a&&t(2,l=a.buttonText)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),[i,m,l,o,u]}class $t extends Fe{constructor(e){super(e),$e(this,e,nu,je,Re,{title:0,description:1,buttonText:2}),V("SvelteRegisterComponent",{component:this,tagName:"Banner",options:e,id:je.name})}get title(){throw new Error("<Banner>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set title(e){throw new Error("<Banner>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get description(){throw new Error("<Banner>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set description(e){throw new Error("<Banner>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get buttonText(){throw new Error("<Banner>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set buttonText(e){throw new Error("<Banner>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const le="C:/Users/Евгений/Documents/AlfaVoice/client/src/lib/components/QuickAccess.svelte";function At(n,e,t){const s=n.slice();return s[4]=e[t],s}function Ge(n){let e,t,s,d,o,i,m=n[4].title+"",l,f,u,a=n[4].description+"",_,r,c,g,E;var B=n[4].icon;function q(k,b){return{props:{size:24},$$inline:!0}}B&&(s=ne(B,q()));function O(){return n[2](n[4])}const R={c:function(){e=D("button"),t=D("div"),s&&Q(s.$$.fragment),d=I(),o=D("div"),i=D("h4"),l=X(m),f=I(),u=D("p"),_=X(a),r=I(),this.h()},l:function(b){e=C(b,"BUTTON",{class:!0});var A=S(e);t=C(A,"DIV",{class:!0});var h=S(t);s&&ee(s.$$.fragment,h),h.forEach(p),d=$(A),o=C(A,"DIV",{class:!0});var F=S(o);i=C(F,"H4",{class:!0});var H=S(i);l=K(H,m),H.forEach(p),f=$(F),u=C(F,"P",{class:!0});var j=S(u);_=K(j,a),j.forEach(p),F.forEach(p),r=$(A),A.forEach(p),this.h()},h:function(){y(t,"class","card-icon svelte-1bcq7he"),w(t,le,38,4,955),y(i,"class","card-title svelte-1bcq7he"),w(i,le,42,5,1079),y(u,"class","card-description svelte-1bcq7he"),w(u,le,43,5,1125),y(o,"class","card-content svelte-1bcq7he"),w(o,le,41,4,1047),y(e,"class","card svelte-1bcq7he"),w(e,le,37,3,891)},m:function(b,A){N(b,e,A),v(e,t),s&&J(s,t,null),v(e,d),v(e,o),v(o,i),v(i,l),v(o,f),v(o,u),v(u,_),v(e,r),c=!0,g||(E=De(e,"click",O,!1,!1,!1),g=!0)},p:function(b,A){if(n=b,B!==(B=n[4].icon)){if(s){ae();const h=s;U(h.$$.fragment,1,0,()=>{z(h,1)}),fe()}B?(s=ne(B,q()),Q(s.$$.fragment),P(s.$$.fragment,1),J(s,t,null)):s=null}},i:function(b){c||(s&&P(s.$$.fragment,b),c=!0)},o:function(b){s&&U(s.$$.fragment,b),c=!1},d:function(b){b&&p(e),s&&z(s),g=!1,E()}};return V("SvelteRegisterBlock",{block:R,id:Ge.name,type:"each",source:"(26:2) {#each cards as card}",ctx:n}),R}function We(n){let e,t,s="Вернуться в поток",d,o,i,m=ke(n[0]),l=[];for(let a=0;a<m.length;a+=1)l[a]=Ge(At(n,m,a));const f=a=>U(l[a],1,1,()=>{l[a]=null}),u={c:function(){e=D("section"),t=D("h3"),t.textContent=s,d=I(),o=D("div");for(let _=0;_<l.length;_+=1)l[_].c();this.h()},l:function(_){e=C(_,"SECTION",{class:!0});var r=S(e);t=C(r,"H3",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-wibglv"&&(t.textContent=s),d=$(r),o=C(r,"DIV",{class:!0});var c=S(o);for(let g=0;g<l.length;g+=1)l[g].l(c);c.forEach(p),r.forEach(p),this.h()},h:function(){y(t,"class","section-title svelte-1bcq7he"),w(t,le,34,1,789),y(o,"class","cards-grid svelte-1bcq7he"),w(o,le,35,1,839),y(e,"class","quick-access svelte-1bcq7he"),w(e,le,33,0,757)},m:function(_,r){N(_,e,r),v(e,t),v(e,d),v(e,o);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(o,null);i=!0},p:function(_,[r]){if(r&3){m=ke(_[0]);let c;for(c=0;c<m.length;c+=1){const g=At(_,m,c);l[c]?(l[c].p(g,r),P(l[c],1)):(l[c]=Ge(g),l[c].c(),P(l[c],1),l[c].m(o,null))}for(ae(),c=m.length;c<l.length;c+=1)f(c);fe()}},i:function(_){if(!i){for(let r=0;r<m.length;r+=1)P(l[r]);i=!0}},o:function(_){l=l.filter(Boolean);for(let r=0;r<l.length;r+=1)U(l[r]);i=!1},d:function(_){_&&p(e),Xe(l,_)}};return V("SvelteRegisterBlock",{block:u,id:We.name,type:"component",source:"",ctx:n}),u}function su(n,e,t){let{$$slots:s={},$$scope:d}=e;Ie("QuickAccess",s,[]);const o=ye(),i=[{id:"code",title:"Code",description:"Голосовой ввод для программирования",icon:zt},{id:"chrome",title:"Chrome",description:"Быстрые заметки в браузере",icon:Qt}];function m(u){o("select",{cardId:u})}const l=[];Object.keys(e).forEach(u=>{!~l.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&console.warn(`<QuickAccess> was created with unknown prop '${u}'`)});const f=u=>m(u.id);return n.$capture_state=()=>({createEventDispatcher:ye,Icons:qe,dispatch:o,cards:i,onCardClick:m}),[i,m,f]}class It extends Fe{constructor(e){super(e),$e(this,e,su,We,Re,{}),V("SvelteRegisterComponent",{component:this,tagName:"QuickAccess",options:e,id:We.name})}}const ue="C:/Users/Евгений/Documents/AlfaVoice/client/src/lib/components/HistoryList.svelte";function St(n,e,t){const s=n.slice();return s[4]=e[t],s}function Tt(n,e,t){const s=n.slice();return s[7]=e[t],s}function ze(n){let e,t,s,d,o,i=n[7].time+"",m,l,f,u=n[7].text+"",a,_,r,c,g;var E=bt;function B(R,k){return{props:{size:16,class:"entry-icon"},$$inline:!0}}E&&(t=ne(E,B()));function q(){return n[2](n[7])}const O={c:function(){e=D("button"),t&&Q(t.$$.fragment),s=I(),d=D("div"),o=D("span"),m=X(i),l=I(),f=D("span"),a=X(u),_=I(),this.h()},l:function(k){e=C(k,"BUTTON",{class:!0});var b=S(e);t&&ee(t.$$.fragment,b),s=$(b),d=C(b,"DIV",{class:!0});var A=S(d);o=C(A,"SPAN",{class:!0});var h=S(o);m=K(h,i),h.forEach(p),l=$(A),f=C(A,"SPAN",{class:!0});var F=S(f);a=K(F,u),F.forEach(p),A.forEach(p),_=$(b),b.forEach(p),this.h()},h:function(){y(o,"class","entry-time svelte-1kxaayy"),w(o,ue,52,8,2248),y(f,"class","entry-text svelte-1kxaayy"),w(f,ue,53,8,2301),y(d,"class","entry-content svelte-1kxaayy"),w(d,ue,51,7,2212),y(e,"class","entry-item svelte-1kxaayy"),w(e,ue,49,6,2061)},m:function(k,b){N(k,e,b),t&&J(t,e,null),v(e,s),v(e,d),v(d,o),v(o,m),v(d,l),v(d,f),v(f,a),v(e,_),r=!0,c||(g=De(e,"click",q,!1,!1,!1),c=!0)},p:function(k,b){if(n=k,E!==(E=bt)){if(t){ae();const A=t;U(A.$$.fragment,1,0,()=>{z(A,1)}),fe()}E?(t=ne(E,B()),Q(t.$$.fragment),P(t.$$.fragment,1),J(t,e,s)):t=null}(!r||b&1)&&i!==(i=n[7].time+"")&&ve(m,i),(!r||b&1)&&u!==(u=n[7].text+"")&&ve(a,u)},i:function(k){r||(t&&P(t.$$.fragment,k),r=!0)},o:function(k){t&&U(t.$$.fragment,k),r=!1},d:function(k){k&&p(e),t&&z(t),c=!1,g()}};return V("SvelteRegisterBlock",{block:O,id:ze.name,type:"each",source:"(33:5) {#each group.entries as entry}",ctx:n}),O}function Qe(n){let e,t,s=n[4].date+"",d,o,i,m,l,f=ke(n[4].entries),u=[];for(let r=0;r<f.length;r+=1)u[r]=ze(Tt(n,f,r));const a=r=>U(u[r],1,1,()=>{u[r]=null}),_={c:function(){e=D("div"),t=D("h4"),d=X(s),o=I(),i=D("div");for(let c=0;c<u.length;c+=1)u[c].c();m=I(),this.h()},l:function(c){e=C(c,"DIV",{class:!0});var g=S(e);t=C(g,"H4",{class:!0});var E=S(t);d=K(E,s),E.forEach(p),o=$(g),i=C(g,"DIV",{class:!0});var B=S(i);for(let q=0;q<u.length;q+=1)u[q].l(B);B.forEach(p),m=$(g),g.forEach(p),this.h()},h:function(){y(t,"class","group-date svelte-1kxaayy"),w(t,ue,46,4,1947),y(i,"class","entries-list svelte-1kxaayy"),w(i,ue,47,4,1992),y(e,"class","history-group svelte-1kxaayy"),w(e,ue,45,3,1915)},m:function(c,g){N(c,e,g),v(e,t),v(t,d),v(e,o),v(e,i);for(let E=0;E<u.length;E+=1)u[E]&&u[E].m(i,null);v(e,m),l=!0},p:function(c,g){if((!l||g&1)&&s!==(s=c[4].date+"")&&ve(d,s),g&3){f=ke(c[4].entries);let E;for(E=0;E<f.length;E+=1){const B=Tt(c,f,E);u[E]?(u[E].p(B,g),P(u[E],1)):(u[E]=ze(B),u[E].c(),P(u[E],1),u[E].m(i,null))}for(ae(),E=f.length;E<u.length;E+=1)a(E);fe()}},i:function(c){if(!l){for(let g=0;g<f.length;g+=1)P(u[g]);l=!0}},o:function(c){u=u.filter(Boolean);for(let g=0;g<u.length;g+=1)U(u[g]);l=!1},d:function(c){c&&p(e),Xe(u,c)}};return V("SvelteRegisterBlock",{block:_,id:Qe.name,type:"each",source:"(29:2) {#each history as group}",ctx:n}),_}function Je(n){let e,t,s="История",d,o,i,m=ke(n[0]),l=[];for(let a=0;a<m.length;a+=1)l[a]=Qe(St(n,m,a));const f=a=>U(l[a],1,1,()=>{l[a]=null}),u={c:function(){e=D("section"),t=D("h3"),t.textContent=s,d=I(),o=D("div");for(let _=0;_<l.length;_+=1)l[_].c();this.h()},l:function(_){e=C(_,"SECTION",{class:!0});var r=S(e);t=C(r,"H3",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-ukje9l"&&(t.textContent=s),d=$(r),o=C(r,"DIV",{class:!0});var c=S(o);for(let g=0;g<l.length;g+=1)l[g].l(c);c.forEach(p),r.forEach(p),this.h()},h:function(){y(t,"class","section-title svelte-1kxaayy"),w(t,ue,42,1,1815),y(o,"class","history-content svelte-1kxaayy"),w(o,ue,43,1,1855),y(e,"class","history-list svelte-1kxaayy"),w(e,ue,41,0,1783)},m:function(_,r){N(_,e,r),v(e,t),v(e,d),v(e,o);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(o,null);i=!0},p:function(_,[r]){if(r&3){m=ke(_[0]);let c;for(c=0;c<m.length;c+=1){const g=St(_,m,c);l[c]?(l[c].p(g,r),P(l[c],1)):(l[c]=Qe(g),l[c].c(),P(l[c],1),l[c].m(o,null))}for(ae(),c=m.length;c<l.length;c+=1)f(c);fe()}},i:function(_){if(!i){for(let r=0;r<m.length;r+=1)P(l[r]);i=!0}},o:function(_){l=l.filter(Boolean);for(let r=0;r<l.length;r+=1)U(l[r]);i=!1},d:function(_){_&&p(e),Xe(l,_)}};return V("SvelteRegisterBlock",{block:u,id:Je.name,type:"component",source:"",ctx:n}),u}function ou(n,e,t){let{$$slots:s={},$$scope:d}=e;Ie("HistoryList",s,[]);const o=ye();let{history:i=[{date:"Сегодня",entries:[{id:"1",time:"14:30",text:"Создайте новый компонент для боковой панели с навигацией"},{id:"2",time:"12:15",text:"Обновите конфигурацию TailwindCSS для поддержки темной темы"},{id:"3",time:"10:45",text:"Добавьте иконки из библиотеки lucide-svelte"}]},{date:"Вчера",entries:[{id:"4",time:"16:20",text:"Настройте WebSocket соединение с сервером"},{id:"5",time:"14:05",text:"Реализуйте логику записи аудио с микрофона"}]}]}=e;function m(u){o("select",{entryId:u})}const l=["history"];Object.keys(e).forEach(u=>{!~l.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&console.warn(`<HistoryList> was created with unknown prop '${u}'`)});const f=u=>m(u.id);return n.$$set=u=>{"history"in u&&t(0,i=u.history)},n.$capture_state=()=>({createEventDispatcher:ye,Icons:qe,dispatch:o,history:i,onEntryClick:m}),n.$inject_state=u=>{"history"in u&&t(0,i=u.history)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),[i,m,f]}class Pt extends Fe{constructor(e){super(e),$e(this,e,ou,Je,Re,{history:0}),V("SvelteRegisterComponent",{component:this,tagName:"HistoryList",options:e,id:Je.name})}get history(){throw new Error("<HistoryList>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set history(e){throw new Error("<HistoryList>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{console:iu}=Gt,x="C:/Users/Евгений/Documents/AlfaVoice/client/src/routes/+page.svelte";function qt(n){let e,t,s,d="Сервер отключен",o;var i=Zt;function m(f,u){return{props:{size:16,class:"status-icon disconnected"},$$inline:!0}}i&&(e=ne(i,m()));const l={c:function(){e&&Q(e.$$.fragment),t=I(),s=D("span"),s.textContent=d,this.h()},l:function(u){e&&ee(e.$$.fragment,u),t=$(u),s=C(u,"SPAN",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-wvxfto"&&(s.textContent=d),this.h()},h:function(){y(s,"class","status-text svelte-2q0u1c"),w(s,x,257,4,9817)},m:function(u,a){e&&J(e,u,a),N(u,t,a),N(u,s,a),o=!0},i:function(u){o||(e&&P(e.$$.fragment,u),o=!0)},o:function(u){e&&U(e.$$.fragment,u),o=!1},d:function(u){u&&(p(t),p(s)),e&&z(e,u)}};return V("SvelteRegisterBlock",{block:l,id:qt.name,type:"else",source:"(193:3) {:else}",ctx:n}),l}function Ut(n){let e,t,s,d="Сервер подключен",o;var i=Jt;function m(f,u){return{props:{size:16,class:"status-icon connected"},$$inline:!0}}i&&(e=ne(i,m()));const l={c:function(){e&&Q(e.$$.fragment),t=I(),s=D("span"),s.textContent=d,this.h()},l:function(u){e&&ee(e.$$.fragment,u),t=$(u),s=C(u,"SPAN",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-166aob3"&&(s.textContent=d),this.h()},h:function(){y(s,"class","status-text svelte-2q0u1c"),w(s,x,254,4,9663)},m:function(u,a){e&&J(e,u,a),N(u,t,a),N(u,s,a),o=!0},i:function(u){o||(e&&P(e.$$.fragment,u),o=!0)},o:function(u){e&&U(e.$$.fragment,u),o=!1},d:function(u){u&&(p(t),p(s)),e&&z(e,u)}};return V("SvelteRegisterBlock",{block:l,id:Ut.name,type:"if",source:"(190:3) {#if $isConnected}",ctx:n}),l}function Mt(n){let e,t,s,d="Записать",o;var i=Xt;function m(f,u){return{props:{size:18},$$inline:!0}}i&&(e=ne(i,m()));const l={c:function(){e&&Q(e.$$.fragment),t=I(),s=D("span"),s.textContent=d,this.h()},l:function(u){e&&ee(e.$$.fragment,u),t=$(u),s=C(u,"SPAN",{"data-svelte-h":!0}),ge(s)!=="svelte-1igdl8d"&&(s.textContent=d),this.h()},h:function(){w(s,x,287,6,10626)},m:function(u,a){e&&J(e,u,a),N(u,t,a),N(u,s,a),o=!0},i:function(u){o||(e&&P(e.$$.fragment,u),o=!0)},o:function(u){e&&U(e.$$.fragment,u),o=!1},d:function(u){u&&(p(t),p(s)),e&&z(e,u)}};return V("SvelteRegisterBlock",{block:l,id:Mt.name,type:"else",source:"(223:5) {:else}",ctx:n}),l}function Ot(n){let e,t,s,d="Остановить",o;var i=Kt;function m(f,u){return{props:{size:18},$$inline:!0}}i&&(e=ne(i,m()));const l={c:function(){e&&Q(e.$$.fragment),t=I(),s=D("span"),s.textContent=d,this.h()},l:function(u){e&&ee(e.$$.fragment,u),t=$(u),s=C(u,"SPAN",{"data-svelte-h":!0}),ge(s)!=="svelte-1h67wdq"&&(s.textContent=d),this.h()},h:function(){w(s,x,284,6,10529)},m:function(u,a){e&&J(e,u,a),N(u,t,a),N(u,s,a),o=!0},i:function(u){o||(e&&P(e.$$.fragment,u),o=!0)},o:function(u){e&&U(e.$$.fragment,u),o=!1},d:function(u){u&&(p(t),p(s)),e&&z(e,u)}};return V("SvelteRegisterBlock",{block:l,id:Ot.name,type:"if",source:"(220:5) {#if isRecording}",ctx:n}),l}function xt(n){let e,t,s;const d={c:function(){e=D("p"),t=X("Нажмите кнопку записи или используйте горячую клавишу "),s=X(n[4]),this.h()},l:function(i){e=C(i,"P",{class:!0});var m=S(e);t=K(m,"Нажмите кнопку записи или используйте горячую клавишу "),s=K(m,n[4]),m.forEach(p),this.h()},h:function(){y(e,"class","placeholder svelte-2q0u1c"),w(e,x,304,4,10963)},m:function(i,m){N(i,e,m),v(e,t),v(e,s)},p:jt,d:function(i){i&&p(e)}};return V("SvelteRegisterBlock",{block:d,id:xt.name,type:"else",source:"(241:3) {:else}",ctx:n}),d}function Nt(n){let e,t;const s={c:function(){e=D("p"),t=X(n[0]),this.h()},l:function(o){e=C(o,"P",{class:!0});var i=S(e);t=K(i,n[0]),i.forEach(p),this.h()},h:function(){y(e,"class","svelte-2q0u1c"),w(e,x,302,4,10924)},m:function(o,i){N(o,e,i),v(e,t)},p:function(o,i){i&1&&ve(t,o[0])},d:function(o){o&&p(e)}};return V("SvelteRegisterBlock",{block:s,id:Nt.name,type:"if",source:"(239:3) {#if $transcription}",ctx:n}),s}function Ze(n){let e,t;const s={c:function(){e=D("div"),t=D("div"),this.h()},l:function(o){e=C(o,"DIV",{class:!0});var i=S(e);t=C(i,"DIV",{class:!0,style:!0}),S(t).forEach(p),i.forEach(p),this.h()},h:function(){y(t,"class","audio-level-bar svelte-2q0u1c"),mt(t,"width",n[2]*100+"%"),w(t,x,310,4,11158),y(e,"class","audio-level svelte-2q0u1c"),w(e,x,309,3,11128)},m:function(o,i){N(o,e,i),v(e,t)},p:function(o,i){i&4&&mt(t,"width",o[2]*100+"%")},d:function(o){o&&p(e)}};return V("SvelteRegisterBlock",{block:s,id:Ze.name,type:"if",source:"(246:2) {#if isRecording}",ctx:n}),s}function Ke(n){let e,t,s,d,o,i,m,l,f,u,a,_,r,c,g,E,B,q,O,R="Транскрипция",k,b,A,h,F,H,j,te,oe,W,Ue,Be,Me,ie,Oe,xe,de,re,Ne,et;t=new Ft({$$inline:!0});const tt=[Ut,qt],he=[];function ut(Z,T){return Z[3]?0:1}i=ut(n),m=he[i]=tt[i](n),r=new $t({$$inline:!0}),r.$on("start-recording",n[6]),g=new It({$$inline:!0});const nt=[Ot,Mt],me=[];function st(Z,T){return Z[1]?0:1}h=st(n),F=me[h]=nt[h](n);function ot(Z,T){return Z[0]?Nt:xt}let Ae=ot(n),Y=Ae(n),L=n[1]&&Ze(n);de=new Pt({$$inline:!0});const it={c:function(){e=D("div"),Q(t.$$.fragment),s=I(),d=D("div"),o=D("div"),m.c(),l=I(),f=D("div"),u=D("span"),a=X(n[4]),_=I(),Q(r.$$.fragment),c=I(),Q(g.$$.fragment),E=I(),B=D("div"),q=D("div"),O=D("h2"),O.textContent=R,k=I(),b=D("div"),A=D("button"),F.c(),oe=I(),W=D("button"),Ue=X("Очистить"),Me=I(),ie=D("div"),Y.c(),Oe=I(),L&&L.c(),xe=I(),Q(de.$$.fragment),this.h()},l:function(T){e=C(T,"DIV",{class:!0});var M=S(e);ee(t.$$.fragment,M),s=$(M),d=C(M,"DIV",{class:!0});var ce=S(d);o=C(ce,"DIV",{class:!0});var _e=S(o);m.l(_e),_e.forEach(p),l=$(ce),f=C(ce,"DIV",{class:!0});var rt=S(f);u=C(rt,"SPAN",{class:!0});var ct=S(u);a=K(ct,n[4]),ct.forEach(p),rt.forEach(p),ce.forEach(p),_=$(M),ee(r.$$.fragment,M),c=$(M),ee(g.$$.fragment,M),E=$(M),B=C(M,"DIV",{class:!0});var pe=S(B);q=C(pe,"DIV",{class:!0});var Se=S(q);O=C(Se,"H2",{class:!0,"data-svelte-h":!0}),ge(O)!=="svelte-a1dn70"&&(O.textContent=R),k=$(Se),b=C(Se,"DIV",{class:!0});var Te=S(b);A=C(Te,"BUTTON",{class:!0,"aria-label":!0});var lt=S(A);F.l(lt),lt.forEach(p),oe=$(Te),W=C(Te,"BUTTON",{class:!0,"aria-label":!0});var at=S(W);Ue=K(at,"Очистить"),at.forEach(p),Te.forEach(p),Se.forEach(p),Me=$(pe),ie=C(pe,"DIV",{class:!0});var ft=S(ie);Y.l(ft),ft.forEach(p),Oe=$(pe),L&&L.l(pe),pe.forEach(p),xe=$(M),ee(de.$$.fragment,M),M.forEach(p),this.h()},h:function(){y(o,"class","status-item svelte-2q0u1c"),w(o,x,251,2,9528),y(u,"class","hotkey-badge svelte-2q0u1c"),w(u,x,261,3,9915),y(f,"class","status-item svelte-2q0u1c"),w(f,x,260,2,9886),y(d,"class","status-bar svelte-2q0u1c"),w(d,x,250,1,9501),y(O,"class","svelte-2q0u1c"),w(O,x,274,3,10180),y(A,"class",H="record-button "+(n[1]?"recording":"")+" svelte-2q0u1c"),A.disabled=j=!n[3],y(A,"aria-label",te=n[1]?"Остановить запись":"Начать запись"),w(A,x,276,4,10237),y(W,"class","clear-button svelte-2q0u1c"),W.disabled=Be=!n[0],y(W,"aria-label","Очистить"),w(W,x,290,4,10677),y(b,"class","panel-actions svelte-2q0u1c"),w(b,x,275,3,10205),y(q,"class","panel-header svelte-2q0u1c"),w(q,x,273,2,10150),y(ie,"class","transcription-content svelte-2q0u1c"),w(ie,x,300,2,10860),y(B,"class","transcription-panel svelte-2q0u1c"),w(B,x,272,1,10114),y(e,"class","dashboard svelte-2q0u1c"),w(e,x,245,0,9418)},m:function(T,M){N(T,e,M),J(t,e,null),v(e,s),v(e,d),v(d,o),he[i].m(o,null),v(d,l),v(d,f),v(f,u),v(u,a),v(e,_),J(r,e,null),v(e,c),J(g,e,null),v(e,E),v(e,B),v(B,q),v(q,O),v(q,k),v(q,b),v(b,A),me[h].m(A,null),v(b,oe),v(b,W),v(W,Ue),v(B,Me),v(B,ie),Y.m(ie,null),v(B,Oe),L&&L.m(B,null),v(e,xe),J(de,e,null),re=!0,Ne||(et=[De(A,"click",n[5],!1,!1,!1),De(W,"click",n[7],!1,!1,!1)],Ne=!0)},p:function(T,[M]){let ce=i;i=ut(T),i!==ce&&(ae(),U(he[ce],1,1,()=>{he[ce]=null}),fe(),m=he[i],m||(m=he[i]=tt[i](T),m.c()),P(m,1),m.m(o,null));let _e=h;h=st(T),h!==_e&&(ae(),U(me[_e],1,1,()=>{me[_e]=null}),fe(),F=me[h],F||(F=me[h]=nt[h](T),F.c()),P(F,1),F.m(A,null)),(!re||M&2&&H!==(H="record-button "+(T[1]?"recording":"")+" svelte-2q0u1c"))&&y(A,"class",H),(!re||M&8&&j!==(j=!T[3]))&&vt(A,"disabled",j),(!re||M&2&&te!==(te=T[1]?"Остановить запись":"Начать запись"))&&y(A,"aria-label",te),(!re||M&1&&Be!==(Be=!T[0]))&&vt(W,"disabled",Be),Ae===(Ae=ot(T))&&Y?Y.p(T,M):(Y.d(1),Y=Ae(T),Y&&(Y.c(),Y.m(ie,null))),T[1]?L?L.p(T,M):(L=Ze(T),L.c(),L.m(B,null)):L&&(L.d(1),L=null)},i:function(T){re||(P(t.$$.fragment,T),P(m),P(r.$$.fragment,T),P(g.$$.fragment,T),P(F),P(de.$$.fragment,T),re=!0)},o:function(T){U(t.$$.fragment,T),U(m),U(r.$$.fragment,T),U(g.$$.fragment,T),U(F),U(de.$$.fragment,T),re=!1},d:function(T){T&&p(e),z(t),he[i].d(),z(r),z(g),me[h].d(),Y.d(),L&&L.d(),z(de),Ne=!1,Ht(et)}};return V("SvelteRegisterBlock",{block:it,id:Ke.name,type:"component",source:"",ctx:n}),it}function Rt(){const n=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg"];for(const e of n)if(MediaRecorder.isTypeSupported(e))return console.log("[DEBUG] Supported MIME type:",e),e;return console.warn("[WARN] No supported MIME type found"),null}function ru(n,e,t){let s,d,o,i;Ve(we,"transcription"),Le(n,we,h=>t(0,d=h)),Ve(be,"isConnected"),Le(n,be,h=>t(3,o=h)),Ve(He,"settingsStore"),Le(n,He,h=>t(15,i=h));let{$$slots:m={},$$scope:l}=e;Ie("Page",m,[]),console.log("[DEBUG] +page.svelte: Script block started");let f=!1,u=0,a="Ctrl+Super",_=null,r="",c=null,g=null,E=null,B=null;dt(async()=>{console.log("[DEBUG] +page.svelte: onMount called"),console.log("[DEBUG] +page.svelte: isTauri() =",Ce()),console.log("[DEBUG] +page.svelte: Connecting to WebSocket"),wt(),Ce()&&(console.log("[DEBUG] +page.svelte: Registering hotkey"),await yt("register_hotkey",{shortcut:a,action:"toggle_recording"})!==null&&console.log("Hotkey registered:",a)),console.log("[DEBUG] +page.svelte: Setting up Tauri event listener"),B=kt("hotkey-pressed",h=>{h.payload==="toggle_recording"&&q()})}),ht(()=>{R(),Dt(),B&&B()});async function q(){f?R():await O()}async function O(){try{const h=i.selectedMicrophoneId,F={audio:h?{deviceId:{exact:h}}:!0};E=await navigator.mediaDevices.getUserMedia(F),c=new AudioContext,g=c.createAnalyser(),c.createMediaStreamSource(E).connect(g);const j=Rt();if(!j){alert("Ваш браузер не поддерживает ни один из поддерживаемых форматов аудио. Пожалуйста, используйте современный браузер (Chrome, Firefox, Edge)."),R();return}const te=new MediaRecorder(E,{mimeType:j});te.onerror=oe=>{const W=oe;console.error("[ERROR] MediaRecorder error:",W.error),alert(`Ошибка записи аудио: ${W.error?.message||"Неизвестная ошибка"}`),R()},te.ondataavailable=oe=>{if(oe.data.size>0){if(!o){console.warn("[WARN] WebSocket not connected, audio data lost"),alert("Сервер отключен. Аудиоданные не будут отправлены. Пожалуйста, подключитесь к серверу.");return}Ct(oe.data)}},te.start(100),_t(),_=Date.now(),t(1,f=!0),k()}catch(h){if(console.error("Failed to start recording:",h),h instanceof Error)switch(h.name){case"NotAllowedError":alert("Доступ к микрофону запрещён. Пожалуйста, разрешите доступ в настройках браузера.");break;case"NotFoundError":alert("Микрофон не найден. Пожалуйста, подключите микрофон и попробуйте снова.");break;case"NotReadableError":alert("Не удалось получить доступ к микрофону. Возможно, другое приложение использует микрофон.");break;case"OverconstrainedError":alert("Устройство не соответствует требуемым ограничениям. Попробуйте другой микрофон.");break;case"SecurityError":alert("Ошибка безопасности при доступе к микрофону. Проверьте настройки браузера.");break;default:alert(`Не удалось получить доступ к микрофону: ${h.message}`)}else alert("Не удалось получить доступ к микрофону: неизвестная ошибка")}}function R(){if(E&&(E.getTracks().forEach(h=>h.stop()),E=null),c&&(c.close(),c=null),gt(),_&&d){const h=(Date.now()-_)/1e3;Bt.addRecording(d,h)}_=null,t(1,f=!1),t(8,u=0)}function k(){if(!(!f||!g))try{const h=g.frequencyBinCount||256,F=new Uint8Array(h);g.getByteFrequencyData(F);const H=F.reduce((j,te)=>j+te,0);t(8,u=H/F.length/255),requestAnimationFrame(k)}catch(h){console.error("Error updating audio level:",h),t(8,u=0)}}function b(){we.set(""),t(9,r="")}const A=[];return Object.keys(e).forEach(h=>{!~A.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&iu.warn(`<Page> was created with unknown prop '${h}'`)}),n.$capture_state=()=>({onMount:dt,onDestroy:ht,isTauri:Ce,safeInvoke:yt,safeListen:kt,isConnected:be,transcription:we,connect:wt,disconnect:tu,sendAudio:Ct,cleanup:Dt,updateStats:pt,startRecordingTracking:_t,stopRecordingTracking:gt,recordingsStore:Bt,settingsStore:He,Header:Ft,Banner:$t,QuickAccess:It,HistoryList:Pt,Icons:qe,isRecording:f,audioLevel:u,hotkey:a,recordingStartTime:_,previousTranscription:r,audioContext:c,analyser:g,mediaStream:E,unlistenHotkey:B,toggleRecording:q,getSupportedMimeType:Rt,startRecording:O,stopRecording:R,updateAudioLevel:k,clearTranscription:b,safeAudioLevel:s,$transcription:d,$isConnected:o,$settingsStore:i}),n.$inject_state=h=>{"isRecording"in h&&t(1,f=h.isRecording),"audioLevel"in h&&t(8,u=h.audioLevel),"hotkey"in h&&t(4,a=h.hotkey),"recordingStartTime"in h&&(_=h.recordingStartTime),"previousTranscription"in h&&t(9,r=h.previousTranscription),"audioContext"in h&&(c=h.audioContext),"analyser"in h&&(g=h.analyser),"mediaStream"in h&&(E=h.mediaStream),"unlistenHotkey"in h&&(B=h.unlistenHotkey),"safeAudioLevel"in h&&t(2,s=h.safeAudioLevel)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&256&&t(2,s=u||0),n.$$.dirty&513&&d&&(pt(d,r),t(9,r=d))},[d,f,s,o,a,q,O,b,u,r]}class gu extends Fe{constructor(e){super(e),$e(this,e,ru,Ke,Re,{}),V("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Ke.name})}}export{gu as component};
