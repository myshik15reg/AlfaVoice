import{c as u,v as o,h as w,f as i,m as d,e as k,a as y,b as x,o as B,d as z}from"../../chunks/ssr.js";import"@tauri-apps/api/core";import"@tauri-apps/api/event";import{d as O,w as m}from"../../chunks/index.js";import{u as R,H as T,s as F}from"../../chunks/Header.js";import{G as P,s as A,M as N}from"../../chunks/settingsStore.js";import{I as p}from"../../chunks/file-text.js";const j=u((t,e,s,r)=>{const n=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];return`${o(p,"Icon").$$render(t,Object.assign({},{name:"arrow-right"},e,{iconNode:n}),{},{default:()=>`${r.default?r.default({}):""}`})}`}),_=u((t,e,s,r)=>{const n=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return`${o(p,"Icon").$$render(t,Object.assign({},{name:"clock"},e,{iconNode:n}),{},{default:()=>`${r.default?r.default({}):""}`})}`}),W=u((t,e,s,r)=>{const n=[["polyline",{points:"16 18 22 12 16 6"}],["polyline",{points:"8 6 2 12 8 18"}]];return`${o(p,"Icon").$$render(t,Object.assign({},{name:"code"},e,{iconNode:n}),{},{default:()=>`${r.default?r.default({}):""}`})}`}),L=u((t,e,s,r)=>{const n=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}]];return`${o(p,"Icon").$$render(t,Object.assign({},{name:"square"},e,{iconNode:n}),{},{default:()=>`${r.default?r.default({}):""}`})}`}),H=u((t,e,s,r)=>{const n=[["path",{d:"M12 20h.01"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764"}],["path",{d:"m2 2 20 20"}]];return`${o(p,"Icon").$$render(t,Object.assign({},{name:"wifi-off"},e,{iconNode:n}),{},{default:()=>`${r.default?r.default({}):""}`})}`}),Y=u((t,e,s,r)=>{const n=[["path",{d:"M12 20h.01"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0"}]];return`${o(p,"Icon").$$render(t,Object.assign({},{name:"wifi"},e,{iconNode:n}),{},{default:()=>`${r.default?r.default({}):""}`})}`});class G{ws=null;url;reconnectInterval;maxReconnectAttempts;reconnectAttempts=0;reconnectTimer=null;isManualClose=!1;lastErrorLogged=0;pingInterval=null;pingIntervalMs=3e4;onOpenCallback=null;onCloseCallback=null;onErrorCallback=null;onMessageCallback=null;constructor(e={}){this.url=e.url||"ws://localhost:8081/ws",this.reconnectInterval=e.reconnectInterval||5e3,this.maxReconnectAttempts=e.maxReconnectAttempts||10}connect(){this.ws&&this.ws.readyState===WebSocket.OPEN||(this.isManualClose=!1,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("[Socket] Connected to",this.url),this.reconnectAttempts=0,this.startPing(),this.onOpenCallback&&this.onOpenCallback()},this.ws.onclose=e=>{console.log("[Socket] Disconnected",e.code,e.reason),this.stopPing(),this.onCloseCallback&&this.onCloseCallback(),!this.isManualClose&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=e=>{const s=Date.now();s-this.lastErrorLogged>5e3&&(console.warn("[Socket] Connection error (server may be offline)"),this.lastErrorLogged=s),this.onErrorCallback&&this.onErrorCallback(e)},this.ws.onmessage=e=>{try{const s=JSON.parse(e.data);if(s.type==="pong"){console.log("[Socket] Pong received");return}this.onMessageCallback&&this.onMessageCallback(s)}catch(s){console.error("[Socket] Failed to parse message:",s)}})}disconnect(){this.isManualClose=!0,this.stopPing(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null)}sendText(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("[Socket] Cannot send message: not connected");return}this.ws.send(e)}sendBinary(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("[Socket] Cannot send binary data: not connected");return}this.ws.send(e)}sendAudio(e){e.arrayBuffer().then(s=>{this.sendBinary(s)})}startPing(){this.stopPing(),this.pingInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e={type:"ping"};this.ws.send(JSON.stringify(e)),console.log("[Socket] Ping sent")}},this.pingIntervalMs)}stopPing(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}scheduleReconnect(){this.reconnectTimer||(this.reconnectAttempts++,console.log(`[Socket] Reconnecting in ${this.reconnectInterval}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=null,this.connect()},this.reconnectInterval))}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}getReadyState(){return this.ws?.readyState??WebSocket.CLOSED}onOpen(e){this.onOpenCallback=e}onClose(e){this.onCloseCallback=e}onError(e){this.onErrorCallback=e}onMessage(e){this.onMessageCallback=e}clearCallbacks(){this.onOpenCallback=null,this.onCloseCallback=null,this.onErrorCallback=null,this.onMessageCallback=null}}function U(t){return new G(t)}const v=U({url:"ws://localhost:8081/ws",reconnectInterval:5e3,maxReconnectAttempts:10}),b=m(!1),q=m(""),$=m(null);O(b,t=>t?"connected":"disconnected");v.onOpen(()=>{b.set(!0),$.set(null)});v.onClose(()=>{b.set(!1)});v.onError(t=>{$.set("Connection error")});v.onMessage(t=>{t.type==="transcription"?q.set(t.text):t.type==="error"&&$.set(t.message)});function J(){v.clearCallbacks(),v.disconnect()}function Q(){const{subscribe:t,update:e,set:s}=m({recordings:[]});return{subscribe:t,addRecording:(r,n)=>{e(a=>({recordings:[{id:crypto.randomUUID(),timestamp:Date.now(),transcription:r,duration:n},...a.recordings]}))},deleteRecording:r=>{e(n=>({recordings:n.recordings.filter(a=>a.id!==r)}))},clearRecordings:()=>{s({recordings:[]})}}}const V=Q(),K={code:".banner.svelte-198123s{background:linear-gradient(135deg, var(--accent), var(--accent-hover));border-radius:16px;padding:2rem;display:flex;justify-content:space-between;align-items:center;gap:2rem;margin-bottom:2rem}.banner-content.svelte-198123s{flex:1}.banner-title.svelte-198123s{font-size:1.5rem;font-weight:700;color:white;margin:0 0 0.5rem 0}.banner-description.svelte-198123s{font-size:1rem;color:rgba(255, 255, 255, 0.9);margin:0;line-height:1.5}.banner-button.svelte-198123s{display:flex;align-items:center;gap:0.5rem;background:white;color:var(--accent);border:none;border-radius:8px;padding:0.75rem 1.5rem;font-size:0.95rem;font-weight:600;cursor:pointer;transition:all 0.2s;white-space:nowrap;font-family:inherit}.banner-button.svelte-198123s:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0, 0, 0, 0.2)}.banner-button.svelte-198123s:active{transform:translateY(0)}@media(max-width: 768px){.banner.svelte-198123s{flex-direction:column;align-items:flex-start}.banner-button.svelte-198123s{width:100%;justify-content:center}}",map:null},X=u((t,e,s,r)=>{w();let{title:n="Настройте звучание AlfaVoice"}=e,{description:a="Адаптируйте голосовой ввод под ваш стиль письма и профессиональный словарь."}=e,{buttonText:c="Начать"}=e;return e.title===void 0&&s.title&&n!==void 0&&s.title(n),e.description===void 0&&s.description&&a!==void 0&&s.description(a),e.buttonText===void 0&&s.buttonText&&c!==void 0&&s.buttonText(c),t.css.add(K),`<div class="banner svelte-198123s"><div class="banner-content svelte-198123s"><h2 class="banner-title svelte-198123s">${i(n)}</h2> <p class="banner-description svelte-198123s">${i(a)}</p></div> <button class="banner-button svelte-198123s"><span>${i(c)}</span> ${o(j||d,"svelte:component").$$render(t,{size:18},{},{})}</button> </div>`}),Z={code:".quick-access.svelte-1bcq7he{margin-bottom:2rem}.section-title.svelte-1bcq7he{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0 0 1rem 0}.cards-grid.svelte-1bcq7he{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:1rem}.card.svelte-1bcq7he{display:flex;align-items:flex-start;gap:1rem;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:12px;padding:1.25rem;cursor:pointer;transition:all 0.2s;text-align:left;font-family:inherit}.card.svelte-1bcq7he:hover{border-color:var(--accent);transform:translateY(-2px)}.card.svelte-1bcq7he:active{transform:translateY(0)}.card-icon.svelte-1bcq7he{width:48px;height:48px;background:var(--bg-hover);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--accent);flex-shrink:0}.card-content.svelte-1bcq7he{flex:1}.card-title.svelte-1bcq7he{font-size:1rem;font-weight:600;color:var(--text-primary);margin:0 0 0.25rem 0}.card-description.svelte-1bcq7he{font-size:0.875rem;color:var(--text-secondary);margin:0;line-height:1.4}",map:null},ee=u((t,e,s,r)=>{w();const n=[{id:"code",title:"Code",description:"Голосовой ввод для программирования",icon:W},{id:"chrome",title:"Chrome",description:"Быстрые заметки в браузере",icon:P}];return t.css.add(Z),`<section class="quick-access svelte-1bcq7he"><h3 class="section-title svelte-1bcq7he" data-svelte-h="svelte-wibglv">Вернуться в поток</h3> <div class="cards-grid svelte-1bcq7he">${k(n,a=>`<button class="card svelte-1bcq7he"><div class="card-icon svelte-1bcq7he">${o(a.icon||d,"svelte:component").$$render(t,{size:24},{},{})}</div> <div class="card-content svelte-1bcq7he"><h4 class="card-title svelte-1bcq7he">${i(a.title)}</h4> <p class="card-description svelte-1bcq7he">${i(a.description)}</p></div> </button>`)}</div> </section>`}),te={code:".history-list.svelte-1kxaayy{background:var(--bg-tertiary);border:1px solid var(--border);border-radius:12px;overflow:hidden}.section-title.svelte-1kxaayy{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0 0 1rem 0}.history-content.svelte-1kxaayy{display:flex;flex-direction:column;gap:1.5rem}.history-group.svelte-1kxaayy{display:flex;flex-direction:column;gap:0.75rem}.group-date.svelte-1kxaayy{font-size:0.875rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.05em;margin:0}.entries-list.svelte-1kxaayy{display:flex;flex-direction:column;gap:0.5rem}.entry-item.svelte-1kxaayy{display:flex;align-items:flex-start;gap:0.75rem;padding:0.75rem 1rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.2s;text-align:left;font-family:inherit}.entry-item.svelte-1kxaayy:hover{border-color:var(--accent);background:var(--bg-hover)}.entry-content.svelte-1kxaayy{flex:1;display:flex;align-items:center;gap:0.75rem}.entry-time.svelte-1kxaayy{font-size:0.875rem;color:var(--text-muted);font-weight:500;flex-shrink:0}.entry-text.svelte-1kxaayy{font-size:0.95rem;color:var(--text-primary);line-height:1.4}",map:null},se=u((t,e,s,r)=>{w();let{history:n=[{date:"Сегодня",entries:[{id:"1",time:"14:30",text:"Создайте новый компонент для боковой панели с навигацией"},{id:"2",time:"12:15",text:"Обновите конфигурацию TailwindCSS для поддержки темной темы"},{id:"3",time:"10:45",text:"Добавьте иконки из библиотеки lucide-svelte"}]},{date:"Вчера",entries:[{id:"4",time:"16:20",text:"Настройте WebSocket соединение с сервером"},{id:"5",time:"14:05",text:"Реализуйте логику записи аудио с микрофона"}]}]}=e;return e.history===void 0&&s.history&&n!==void 0&&s.history(n),t.css.add(te),`<section class="history-list svelte-1kxaayy"><h3 class="section-title svelte-1kxaayy" data-svelte-h="svelte-ukje9l">История</h3> <div class="history-content svelte-1kxaayy">${k(n,a=>`<div class="history-group svelte-1kxaayy"><h4 class="group-date svelte-1kxaayy">${i(a.date)}</h4> <div class="entries-list svelte-1kxaayy">${k(a.entries,c=>`<button class="entry-item svelte-1kxaayy">${o(_||d,"svelte:component").$$render(t,{size:16,class:"entry-icon"},{},{})} <div class="entry-content svelte-1kxaayy"><span class="entry-time svelte-1kxaayy">${i(c.time)}</span> <span class="entry-text svelte-1kxaayy">${i(c.text)}</span></div> </button>`)}</div> </div>`)}</div> </section>`}),ne={code:".dashboard.svelte-2q0u1c.svelte-2q0u1c{display:flex;flex-direction:column;gap:1.5rem;padding:2rem;max-width:1000px;margin:0 auto}.status-bar.svelte-2q0u1c.svelte-2q0u1c{display:flex;justify-content:space-between;align-items:center;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:8px;padding:0.75rem 1rem}.status-item.svelte-2q0u1c.svelte-2q0u1c{display:flex;align-items:center;gap:0.5rem}.status-text.svelte-2q0u1c.svelte-2q0u1c{font-size:0.875rem;color:var(--text-secondary);font-weight:500}.hotkey-badge.svelte-2q0u1c.svelte-2q0u1c{background:var(--bg-hover);border:1px solid var(--border);border-radius:4px;padding:0.25rem 0.5rem;font-size:0.75rem;color:var(--text-secondary);font-weight:600}.transcription-panel.svelte-2q0u1c.svelte-2q0u1c{background:var(--bg-tertiary);border:1px solid var(--border);border-radius:12px;overflow:hidden}.panel-header.svelte-2q0u1c.svelte-2q0u1c{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border)}.panel-header.svelte-2q0u1c h2.svelte-2q0u1c{font-size:1.1rem;font-weight:600;color:var(--text-primary);margin:0}.panel-actions.svelte-2q0u1c.svelte-2q0u1c{display:flex;gap:0.5rem}.record-button.svelte-2q0u1c.svelte-2q0u1c{display:flex;align-items:center;gap:0.5rem;background:var(--accent);color:white;border:none;border-radius:8px;padding:0.5rem 1rem;font-size:0.875rem;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit}.record-button.svelte-2q0u1c.svelte-2q0u1c:hover:not(:disabled){background:var(--accent-hover)}.record-button.svelte-2q0u1c.svelte-2q0u1c:disabled{opacity:0.5;cursor:not-allowed}.record-button.recording.svelte-2q0u1c.svelte-2q0u1c{background:var(--error-color);animation:svelte-2q0u1c-pulse-ring 1s infinite}@keyframes svelte-2q0u1c-pulse-ring{0%{box-shadow:0 0 0 0 rgba(239, 68, 68, 0.4)}50%{box-shadow:0 0 0 8px rgba(239, 68, 68, 0)}100%{box-shadow:0 0 0 0 rgba(239, 68, 68, 0)}}.clear-button.svelte-2q0u1c.svelte-2q0u1c{background:var(--bg-hover);color:var(--text-primary);border:1px solid var(--border);border-radius:8px;padding:0.5rem 1rem;font-size:0.875rem;font-weight:500;cursor:pointer;transition:all 0.2s;font-family:inherit}.clear-button.svelte-2q0u1c.svelte-2q0u1c:hover:not(:disabled){background:var(--border-hover)}.clear-button.svelte-2q0u1c.svelte-2q0u1c:disabled{opacity:0.5;cursor:not-allowed}.transcription-content.svelte-2q0u1c.svelte-2q0u1c{padding:1.5rem;min-height:150px;max-height:300px;overflow-y:auto}.transcription-content.svelte-2q0u1c p.svelte-2q0u1c{line-height:1.8;color:var(--text-primary)}.placeholder.svelte-2q0u1c.svelte-2q0u1c{color:var(--text-muted) !important;font-style:italic}.audio-level.svelte-2q0u1c.svelte-2q0u1c{height:4px;background:var(--bg-secondary);border-radius:2px;overflow:hidden}.audio-level-bar.svelte-2q0u1c.svelte-2q0u1c{height:100%;background:linear-gradient(90deg, var(--accent), var(--accent-hover));transition:width 0.1s}@media(max-width: 768px){.dashboard.svelte-2q0u1c.svelte-2q0u1c{padding:1rem}.panel-header.svelte-2q0u1c.svelte-2q0u1c{flex-direction:column;align-items:flex-start;gap:1rem}.panel-actions.svelte-2q0u1c.svelte-2q0u1c{width:100%}.record-button.svelte-2q0u1c.svelte-2q0u1c,.clear-button.svelte-2q0u1c.svelte-2q0u1c{flex:1}}",map:null},de=u((t,e,s,r)=>{let n,a,c,g,C,E;y(q,"transcription"),c=x(q,l=>a=l),y(b,"isConnected"),C=x(b,l=>g=l),y(A,"settingsStore"),E=x(A,l=>l),console.log("[DEBUG] +page.svelte: Script block started");let h=!1,S=0,M="Ctrl+Super",f=null,D="";B(()=>{I(),J()});function I(){if(F(),f&&a){const l=(Date.now()-f)/1e3;V.addRecording(a,l)}f=null,h=!1,S=0}return t.css.add(ne),n=S||0,a&&(R(a,D),D=a),c(),C(),E(),`<div class="dashboard svelte-2q0u1c"> ${o(T,"Header").$$render(t,{},{},{})}  <div class="status-bar svelte-2q0u1c"><div class="status-item svelte-2q0u1c">${g?`${o(Y||d,"svelte:component").$$render(t,{size:16,class:"status-icon connected"},{},{})} <span class="status-text svelte-2q0u1c" data-svelte-h="svelte-166aob3">Сервер подключен</span>`:`${o(H||d,"svelte:component").$$render(t,{size:16,class:"status-icon disconnected"},{},{})} <span class="status-text svelte-2q0u1c" data-svelte-h="svelte-wvxfto">Сервер отключен</span>`}</div> <div class="status-item svelte-2q0u1c"><span class="hotkey-badge svelte-2q0u1c">${i(M)}</span></div></div>  ${o(X,"Banner").$$render(t,{},{},{})}  ${o(ee,"QuickAccess").$$render(t,{},{},{})}  <div class="transcription-panel svelte-2q0u1c"><div class="panel-header svelte-2q0u1c"><h2 class="svelte-2q0u1c" data-svelte-h="svelte-a1dn70">Транскрипция</h2> <div class="panel-actions svelte-2q0u1c"><button class="${"record-button "+i(h?"recording":"",!0)+" svelte-2q0u1c"}" ${g?"":"disabled"}${z("aria-label",h?"Остановить запись":"Начать запись",0)}>${h?`${o(L||d,"svelte:component").$$render(t,{size:18},{},{})} <span data-svelte-h="svelte-1h67wdq">Остановить</span>`:`${o(N||d,"svelte:component").$$render(t,{size:18},{},{})} <span data-svelte-h="svelte-1igdl8d">Записать</span>`}</button> <button class="clear-button svelte-2q0u1c" ${a?"":"disabled"} aria-label="Очистить">Очистить</button></div></div> <div class="transcription-content svelte-2q0u1c">${a?`<p class="svelte-2q0u1c">${i(a)}</p>`:`<p class="placeholder svelte-2q0u1c">Нажмите кнопку записи или используйте горячую клавишу ${i(M)}</p>`}</div>  ${h?`<div class="audio-level svelte-2q0u1c"><div class="audio-level-bar svelte-2q0u1c" style="${"width: "+i(n*100,!0)+"%"}"></div></div>`:""}</div>  ${o(se,"HistoryList").$$render(t,{},{},{})} </div>`});export{de as default};
