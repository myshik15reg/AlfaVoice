import*as $ from"devalue";import{t as k,b as O,c as L}from"./utils.js";const S=!0;function I(s,t,e){t.startsWith("n:")?(t=t.slice(2),e=e===""?void 0:parseFloat(e)):t.startsWith("b:")&&(t=t.slice(2),e=e==="on"),B(s,M(t),e)}function P(s){const t={};for(let e of s.keys()){const n=e.endsWith("[]");let r=s.getAll(e);if(n&&(e=e.slice(0,-2)),r.length>1&&!n)throw new Error(`Form cannot contain duplicated keys â€” "${e}" has ${r.length} values`);r=r.filter(i=>typeof i=="string"||i.name!==""||i.size>0),e.startsWith("n:")?(e=e.slice(2),r=r.map(i=>i===""?void 0:parseFloat(i))):e.startsWith("b:")&&(e=e.slice(2),r=r.map(i=>i==="on")),I(t,e,n?r:r[0])}return t}const R="application/x-sveltekit-formdata",E=0;async function W(s){if(s.headers.get("content-type")!==R){const f=await s.formData();return{data:P(f),meta:{},form_data:f}}if(!s.body)throw new Error("Could not deserialize binary form: no body");const t=s.body.getReader(),e=[];async function n(f){if(f in e)return e[f];let a=e.length;for(;a<=f;)e[a]=t.read().then(h=>h.value),a++;return e[f]}async function r(f,a){let h,d=0,b;for(b=0;;b++){const y=await n(b);if(!y)return null;const z=d+y.byteLength;if(f>=d&&f<z){h=y;break}d=z}if(f+a<=d+h.byteLength)return h.subarray(f-d,f+a-d);const v=new Uint8Array(a);v.set(h.subarray(f-d));let p=h.byteLength-f+d;for(;p<a;){b++;let y=await n(b);if(!y)return null;y.byteLength>a-p&&(y=y.subarray(0,a-p)),v.set(y,p),p+=y.byteLength}return v}const i=await r(0,7);if(!i)throw new Error("Could not deserialize binary form: too short");if(i[0]!==E)throw new Error(`Could not deserialize binary form: got version ${i[0]}, expected version ${E}`);const u=new DataView(i.buffer,i.byteOffset,i.byteLength),l=u.getUint32(1,!0),m=u.getUint16(5,!0),_=await r(7,l);if(!_)throw new Error("Could not deserialize binary form: data too short");let o,c;if(m>0){const f=await r(7+l,m);if(!f)throw new Error("Could not deserialize binary form: file offset table too short");o=JSON.parse(k.decode(f)),c=7+l+m}const[w,A]=$.parse(k.decode(_),{File:([f,a,h,d,b])=>new Proxy(new x(f,a,h,d,n,c+o[b]),{getPrototypeOf(){return File.prototype}})});return(async()=>{let f=!0;for(;f;)f=!!await n(e.length)})(),{data:w,meta:A,form_data:null}}class x{#t;#e;constructor(t,e,n,r,i,u){this.name=t,this.type=e,this.size=n,this.lastModified=r,this.webkitRelativePath="",this.#t=i,this.#e=u,this.arrayBuffer=this.arrayBuffer.bind(this),this.bytes=this.bytes.bind(this),this.slice=this.slice.bind(this),this.stream=this.stream.bind(this),this.text=this.text.bind(this)}#r;async arrayBuffer(){return this.#r??=await new Response(this.stream()).arrayBuffer(),this.#r}async bytes(){return new Uint8Array(await this.arrayBuffer())}slice(t=0,e=this.size,n=this.type){t<0?t=Math.max(this.size+t,0):t=Math.min(t,this.size),e<0?e=Math.max(this.size+e,0):e=Math.min(e,this.size);const r=Math.max(e-t,0);return new x(this.name,n,r,this.lastModified,this.#t,this.#e+t)}stream(){let t=0,e=0;return new ReadableStream({start:async n=>{let r=0,i=null;for(e=0;;e++){const u=await this.#t(e);if(!u)return null;const l=r+u.byteLength;if(this.#e>=r&&this.#e<l){i=u;break}r=l}this.#e+this.size<=r+i.byteLength?(n.enqueue(i.subarray(this.#e-r,this.#e+this.size-r)),n.close()):(n.enqueue(i.subarray(this.#e-r)),t=i.byteLength-this.#e+r)},pull:async n=>{e++;let r=await this.#t(e);if(!r){n.error("Could not deserialize binary form: incomplete file data"),n.close();return}r.byteLength>this.size-t&&(r=r.subarray(0,this.size-t)),n.enqueue(r),t+=r.byteLength,t>=this.size&&n.close()}})}async text(){return k.decode(await this.arrayBuffer())}}const T=/^[a-zA-Z_$]\w*(\.[a-zA-Z_$]\w*|\[\d+\])*$/;function M(s){if(!T.test(s))throw new Error(`Invalid path ${s}`);return s.split(/\.|\[|\]/).filter(Boolean)}function j(s){if(s==="__proto__"||s==="constructor"||s==="prototype")throw new Error(`Invalid key "${s}": This key is not allowed to prevent prototype pollution.`)}function B(s,t,e){let n=s;for(let i=0;i<t.length-1;i+=1){const u=t[i];j(u);const l=/^\d+$/.test(t[i+1]),m=u in n,_=n[u];if(m&&l!==Array.isArray(_))throw new Error(`Invalid array key ${t[i+1]}`);m||(n[u]=l?[]:{}),n=n[u]}const r=t[t.length-1];j(r),n[r]=e}function U(s,t=!1){const e={name:"",path:[],message:s.message,server:t};if(s.path!==void 0){let n="";for(const r of s.path){const i=typeof r=="object"?r.key:r;e.path.push(i),typeof i=="number"?n+=`[${i}]`:typeof i=="string"&&(n+=n===""?i:"."+i)}e.name=n}return e}function V(s){const t={};for(const e of s){(t.$??=[]).push(e);let n="";if(e.path!==void 0)for(const r of e.path)typeof r=="number"?n+=`[${r}]`:typeof r=="string"&&(n+=n===""?r:"."+r),(t[n]??=[]).push(e)}return t}function D(s,t){let e=s;for(const n of t){if(e==null||typeof e!="object")return e;e=e[n]}return e}function g(s,t,e,n,r=[]){const i=()=>D(t(),r);return new Proxy(s,{get(u,l){if(typeof l=="symbol")return u[l];if(/^\d+$/.test(l))return g({},t,e,n,[...r,parseInt(l,10)]);const m=F(r);return l==="set"?g(function(o){return e(r,o),o},t,e,n,[...r,l]):l==="value"?g(i,t,e,n,[...r,l]):l==="issues"||l==="allIssues"?g(()=>{const o=n()[m===""?"$":m];return l==="allIssues"?o?.map(c=>({path:c.path,message:c.message})):o?.filter(c=>c.name===m)?.map(c=>({path:c.path,message:c.message}))},t,e,n,[...r,l]):l==="as"?g((o,c)=>{const w=o==="file multiple"||o==="select multiple"||o==="checkbox"&&typeof c=="string",f={name:(o==="number"||o==="range"?"n:":o==="checkbox"&&!w?"b:":"")+m+(w?"[]":""),get"aria-invalid"(){const a=n();return m in a?"true":void 0}};if(o!=="text"&&o!=="select"&&o!=="select multiple"&&(f.type=o==="file multiple"?"file":o),o==="submit"||o==="hidden"){if(!c)throw new Error(`\`${o}\` inputs must have a value`);return Object.defineProperties(f,{value:{value:c,enumerable:!0}})}if(o==="select"||o==="select multiple")return Object.defineProperties(f,{multiple:{value:w,enumerable:!0},value:{enumerable:!0,get(){return i()}}});if(o==="checkbox"||o==="radio"){{if(o==="radio"&&!c)throw new Error("Radio inputs must have a value");if(o==="checkbox"&&w&&!c)throw new Error("Checkbox array inputs must have a value")}return Object.defineProperties(f,{value:{value:c??"on",enumerable:!0},checked:{enumerable:!0,get(){const a=i();return o==="radio"?a===c:w?(a??[]).includes(c):a}}})}return o==="file"||o==="file multiple"?Object.defineProperties(f,{multiple:{value:w,enumerable:!0},files:{enumerable:!0,get(){const a=i();if(a instanceof File){if(typeof DataTransfer<"u"){const h=new DataTransfer;return h.items.add(a),h.files}return{0:a,length:1}}if(Array.isArray(a)&&a.every(h=>h instanceof File)){if(typeof DataTransfer<"u"){const d=new DataTransfer;return a.forEach(b=>d.items.add(b)),d.files}const h={length:a.length};return a.forEach((d,b)=>{h[b]=d}),h}return null}}}):Object.defineProperties(f,{value:{enumerable:!0,get(){const a=i();return a!=null?String(a):""}}})},t,e,n,[...r,"as"]):g({},t,e,n,[...r,l])}})}function F(s){let t="";for(const e of s)typeof e=="number"?t+=`[${e}]`:t+=t===""?e:"."+e;return t}function Y(s){Object.defineProperty(s,"field",{value:t=>{const e=t.endsWith("[]")?t.slice(0,-2):t;throw new Error(`\`form.field\` has been removed: Instead of \`<input name={form.field('${t}')} />\` do \`<input {...form.fields.${e}.as(type)} />\``)}});for(const t of["input","issues"])Object.defineProperty(s,t,{get(){const e=t==="issues"?"issues":"value";return new Proxy({},{get(n,r){const i=typeof r=="string"?r:String(r),u=i.includes("[")||i.includes(".")?`['${i}']`:`.${i}`,l=`.${i}.${e}()`;throw new Error(`\`form.${t}\` has been removed: Instead of \`form.${t}${u}\` write \`form.fields${l}\``)}})}})}function Z(s,t){const e=/^(moz-icon|view-source|jar):/.exec(t);e&&console.warn(`${s}: Calling \`depends('${t}')\` will throw an error in Firefox because \`${e[1]}\` is a special URI scheme`)}const G="x-sveltekit-invalidated",H="x-sveltekit-trailing-slash";function J(s,t){if(s!=null&&Object.getPrototypeOf(s)!==Object.prototype)throw new Error(`a load function ${t} returned ${typeof s!="object"?`a ${typeof s}`:s instanceof Response?"a Response object":Array.isArray(s)?"an array":"a non-plain object"}, but must return a plain object at the top level (i.e. \`return {...}\`)`)}function C(s,t){const e=Object.fromEntries(Object.entries(t).map(([n,r])=>[n,r.encode]));return $.stringify(s,e)}function q(s,t){if(s===void 0)return"";const e=C(s,t),n=new TextEncoder().encode(e);return O(n).replaceAll("=","").replaceAll("+","-").replaceAll("/","_")}function K(s,t){if(!s)return;const e=k.decode(L(s.replaceAll("-","+").replaceAll("_","/"))),n=Object.fromEntries(Object.entries(t).map(([r,i])=>[r,i.decode]));return $.parse(e,n)}function Q(s,t){return s+"/"+t}export{R as B,S as D,G as I,H as T,J as a,q as b,Q as c,W as d,g as e,V as f,I as g,B as h,U as n,K as p,C as s,Y as t,Z as v};
