# Отчет по технической оценке миграции AlfaVoice на Svelte

**Дата:** 07.01.2026
**Статус:** Рекомендована миграция
**Автор:** Solution Architect

## 1. Резюме
На основе анализа текущей кодовой базы (React 19) и требований к продукту (Desktop-приложение с аудио-процессингом через Tauri), **рекомендуется полная миграция на Svelte 5**.

Текущая реализация на React имеет архитектурные риски (монолитный Context API), которые будут усугубляться при добавлении функционала реального времени (визуализация аудио). Svelte 5 предлагает нативную производительность и модель реактивности, идеально подходящую для desktop-first приложений с частыми обновлениями состояния.

---

## 2. Сравнительный анализ

### 2.1. Производительность и Реактивность
*   **Текущая ситуация (React):**
    *   Используется глобальный `AppContext` (500+ строк), содержащий всё: от настроек пользователя до состояния `MediaRecorder`.
    *   **Проблема:** Любое изменение (например, таймера записи) вызывает перерисовку всех компонентов, подписанных на контекст. Для аудио-визуализации (waveform) это потребует сложных оптимизаций (React.memo, вынос стейта).
*   **Svelte 5 (Runes):**
    *   Использует Fine-grained reactivity. Изменение переменной `$state` обновляет точечно DOM-узлы.
    *   **Выигрыш:** Визуализация аудио (60 FPS) не будет нагружать основной поток и блокировать интерфейс, без необходимости ручной мемоизации.

### 2.2. Размер бандла и Инициализация (Tauri Context)
*   **React:** Требует загрузки VDOM runtime (~30-40KB gzipped + зависимости). Для десктопного приложения это увеличивает потребление памяти (RAM) каждого окна.
*   **Svelte:** Компилируется в императивный код. Runtime минимален.
*   **Выигрыш:** Меньшее потребление памяти (критично для приложения, работающего в фоне) и более быстрый "холодный" старт окна.

### 2.3. Интеграция с Rust / Tauri
*   Svelte является "золотым стандартом" в экосистеме Tauri.
*   Статические генерации (SSG) в SvelteKit идеально ложатся на модель Tauri (SPA).
*   Отсутствие VDOM упрощает взаимодействие с Rust-бэкендом через IPC (события обновляют стейт напрямую).

### 2.4. Developer Experience (DX)
*   **React:** `useEffect` в `AppContext` перегружен логикой синхронизации.
*   **Svelte 5:** Руны `$effect` и `$derived` делают логику синхронизации прозрачной. Логика выносится из компонентов в отдельные `.svelte.ts` файлы (магазины), что решает проблему "толстых" компонентов.

---

## 3. Оценка сложности миграции

**Объем текущего кода:**
*   ~15 компонентов UI.
*   1 глобальный контекст (`AppContext.tsx`).
*   Mock DB и типы.

**Трудозатраты:**
*   **Низкие/Средние.** Проект находится на стадии прототипа.
*   **Оценка времени:** 2-3 рабочих дня для опытного разработчика.
    *   1 день: Настройка SvelteKit + Tauri + Tailwind v4.
    *   1 день: Перенос UI компонентов (JSX -> HTML/CSS).
    *   1 день: Рефакторинг логики `AppContext` на Svelte Runes.

---

## 4. План миграции

1.  **Инициализация:**
    *   Создать новый проект `client-svelte` на базе SvelteKit (adapter-static) + Tauri v2.
2.  **Архитектура состояния (Store Migration):**
    *   Разбить монолитный `AppContext` на модульные сторы с использованием рун:
        *   `auth.svelte.ts` (User)
        *   `audio.svelte.ts` (Recorder logic)
        *   `settings.svelte.ts` (App preferences)
        *   `db.svelte.ts` (Local data)
3.  **UI Миграция:**
    *   Перенос компонентов. Tailwind классы копируются 1-в-1.
    *   Замена `react-router` на файловый роутинг SvelteKit.
4.  **Tauri Интеграция:**
    *   Замена Mock API на реальные вызовы Rust команд (Tauri Commands).

## 5. Рекомендация

**ВЕРДИКТ: МИГРИРОВАТЬ.**
Оставаться на React нецелесообразно, так как проект не обременен легаси, а требования к производительности аудио-приложения лучше удовлетворяются архитектурой Svelte.