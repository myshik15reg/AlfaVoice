# Workflow: Обновление индексных файлов (update-indexes)

## Описание
Этот рабочий процесс обновляет индексные файлы (`index.md`) в папках проекта для повышения прозрачности данных для агента. Индексные файлы создают оглавление папок с описаниями файлов.

## Когда использовать
Используйте этот workflow когда:
- Добавлен новый файл `.md` в папку с индексом
- Удален файл из папки с индексом
- Изменено описание файла (frontmatter или первый абзац)
- Завершен протокол (обновить `.protocols/.../index.md`)
- При инициализации проекта для создания индексов

---

## Шаг 1: Определение папок для индексации

**Цель:** Определить, какие папки требуют индексных файлов.

**Критерии:**
- Папки с **3 и более** файлами `.md`
- Папки `.protocols/` (каждый протокол)
- Папки `.kilocode/skills/`
- Папки `.kilocode/workflows/`
- Папки `.kilocode/rules/memory-bank/`

**Действия:**
1. Пройдитесь по файловой системе проекта
2. Для каждой папки подсчитайте количество файлов `.md`
3. Составьте список папок, требующих индексации

**Результат:** Список папок для обработки

---

## Шаг 2: Сбор описаний файлов

**Цель:** Собрать описания для всех файлов в папках, требующих индексации.

**Приоритет описаний (в порядке убывания):**
1. **Frontmatter**: Если файл содержит YAML frontmatter с полем `description`
   ```yaml
   ---
   description: Краткое описание файла
   ---
   ```

2. **Первый абзац**: Если нет frontmatter, использовать первый абзац файла
   - Первый абзац после заголовка `#`
   - Игнорировать пустые строки и списки

3. **Автогенерация**: Если нет описания, сгенерировать краткое резюме
   - На основе заголовка файла (`# Заголовок`)
   - На основе имени файла (если нет заголовка)

**Действия:**
1. Для каждой папки из списка
2. Прочитать каждый файл `.md`
3. Извлечь описание по приоритету
4. Сохранить описание в формате: `filename.md` — `Описание`

**Результат:** Структура данных с описаниями для каждой папки

---

## Шаг 3: Генерация/обновление index.md

**Цель:** Создать или обновить файл `index.md` в каждой папке.

**Шаблон index.md:**
```markdown
# [Название папки]

## Files
- [`filename.md`](filename.md) — Краткое описание (из frontmatter `description` или первого абзаца)
- [`filename2.md`](filename2.md) — Краткое описание
```

**Правила форматирования:**
- Заголовок `#` — название папки (или `Protocol: [имя протокола]` для `.protocols/`)
- Секция `## Files` — список всех файлов
- Формат записи: `- [`имя файла`](`имя файла`) — описание`
- Файлы сортируются в алфавитном порядке
- Использовать кириллицу для описаний на русском языке

**Действия:**
1. Для каждой папки создать или перезаписать `index.md`
2. Использовать собранные описания из Шага 2
3. Следовать шаблону и правилам форматирования
4. Сохранить файл в папке

**Проверка:** Файл `index.md` создан/обновлен успешно

---

## Шаг 4: Проверка качества

**Цель:** Убедиться, что все индексные файлы корректны и полезны.

**Чеклист качества:**
- [ ] Все файлы `.md` в папке включены в `index.md`
- [ ] Описания понятны и информативны
- [ ] Форматирование соответствует шаблону
- [ ] Ссылки на файлы корректны
- [ ] Нет дубликатов в списке файлов
- [ ] Файлы отсортированы в алфавитном порядке

**Действия:**
1. Проверить каждый `index.md` по чеклисту
2. Исправить обнаруженные проблемы
3. При необходимости перегенерировать проблемные индексы

**Проверка:** Все индексные файлы прошли проверку качества

---

## Шаг 5: Обновление Memory Bank (опционально)

**Цель:** Зафиксировать изменения в Memory Bank, если это значительное обновление.

**Действия:**
1. Обновить `.kilocode/rules/memory-bank/architecture.md` — добавить информацию о структуре индексных файлов
2. Обновить `.kilocode/rules/memory-bank/context.md` — отметить задачу как выполненную
3. Обновить `.kilocode/rules/memory-bank/context.md` — очистить фокус на индексации

**Примечание:** Этот шаг выполняется только при значительном обновлении (например, при инициализации проекта).

---

## Примеры

### Пример 1: Индекс для папки `.protocols/0105-add-auth/`

```markdown
# Protocol: Add Authentication

## Files
- [`brief.md`](brief.md) — Краткое описание задачи и критерии приемки
- [`plan.md`](plan.md) — Декомпозиция задачи на шаги (Todo List)
- [`execution.md`](execution.md) — Лог выполнения, проблемы и решения
- [`context.md`](context.md) — Специфический контекст для этой задачи
```

### Пример 2: Индекс для папки `.kilocode/skills/`

```markdown
# Skills

## Files
- [`project-tests.md`](project-tests.md) — Стандартизированный процесс тестирования
- [`cli-master.md`](cli-master.md) — Безопасная и эффективная работа с командной строкой
- [`database-migration.md`](database-migration.md) — Управление миграциями базы данных
```

### Пример 3: Индекс для папки `.kilocode/rules/memory-bank/`

```markdown
# Memory Bank

## Files
- [`context.md`](context.md) — Текущий фокус работы, активные протоколы, недавние решения
- [`product.md`](product.md) — Цели продукта, проблемы пользователей, UX-принципы
- [`architecture.md`](architecture.md) — Архитектурные решения, дизайн-паттерны, стандарты кода
- [`tech.md`](tech.md) — Стек технологий, зависимости, ограничения среды
- [`context.md`](context.md) — Статус проекта: что сделано, что в планах
```

---

## Интеграция с существующими workflow

### При создании нового протокола (protocol-new.md)
После создания структуры протокола:
1. Создать `index.md` в папке `.protocols/{protocol_number}-{task_name}/`
2. Включить файлы: `brief.md`, `plan.md`, `execution.md`, `context.md` (если созданы)

### При завершении протокола (protocol-review-merge.md)
Перед закрытием протокола:
1. Обновить `index.md` в папке протокола
2. Убедиться, что все файлы включены
3. Проверить актуальность описаний

### При создании нового скилла (create-new-skill.md)
После создания скилла:
1. Обновить `index.md` в папке `.kilocode/skills/`
2. Добавить новый скилл в список
3. Проверить описание нового скилла

---

## Автоматизация (опционально)

Для автоматического обновления индексных файлов можно создать скрипт:

```bash
# Пример команды для обновления индексов
python .kilocode/scripts/update-indexes.py
```

Скрипт должен:
1. Сканировать файловую систему
2. Определять папки для индексации
3. Собирать описания файлов
4. Генерировать/обновлять `index.md`
5. Проверять качество индексов

---

## Триггеры обновления

Обновление индексных файлов требуется при:

| Событие | Действие |
|---|---|
| Добавлен новый файл `.md` | Обновить `index.md` в соответствующей папке |
| Удален файл `.md` | Обновить `index.md` в соответствующей папке |
| Изменен frontmatter `description` | Обновить описание в `index.md` |
| Изменен первый абзац файла | Обновить описание в `index.md` |
| Завершен протокол | Обновить `index.md` в папке протокола |
| Создан новый скилл | Обновить `index.md` в `.kilocode/skills/` |
| Создан новый workflow | Обновить `index.md` в `.kilocode/workflows/` |

---

## Лучшие практики

1. **Регулярное обновление**: Обновляйте индексы при каждом значительном изменении файловой структуры
2. **Качество описаний**: Пишите понятные и информативные описания
3. **Frontmatter**: Используйте frontmatter для описаний файлов, когда это возможно
4. **Согласованность**: Следуйте единому стилю форматирования индексов
5. **Проверка**: Регулярно проверяйте актуальность индексных файлов

---

## Отчет о выполнении

После завершения работы предоставьте отчет:

```
**Обновление индексных файлов завершено**

**Обработано папок:** N
**Создано индексов:** N
**Обновлено индексов:** N

**Список обработанных папок:**
- `.kilocode/rules/memory-bank/` — 5 файлов
- `.kilocode/skills/` — 3 файла
- `.kilocode/workflows/` — 6 файлов
- `.protocols/0105-add-auth/` — 4 файла

**Проблемы:** (если есть)
- [описание проблемы и решение]
```
