# jdocstring - Стандарт документирования кода 1С

## Обзор

jdocstring — стандарт документирования кода BSL (1С), основанный на JSDoc/TSDoc с адаптацией под особенности платформы 1С:Предприятие.

## Базовый синтаксис

Все комментарии jdocstring начинаются с `///` (три слэша):

```bsl
/// Это однострочный комментарий jdocstring
```

## Обязательные теги

### @description

Описание функции/процедуры. Может быть многострочным.

```bsl
/// @description Рассчитывает график платежей по договору лизинга.
///              Учитывает процентную ставку, срок и сумму договора.
///              Поддерживает различные схемы погашения.
```

### @param

Описание параметра. Формат: `@param {Тип} ИмяПараметра - Описание`

```bsl
/// @param {Справочник.ДоговорыЛизинга} Договор - Договор лизинга
/// @param {Число} Сумма - Сумма для расчёта (в рублях)
/// @param {Дата} ДатаНачала - Дата начала графика
/// @param {Булево} ВключатьНДС - Флаг включения НДС в расчёт
```

**Типы данных 1С для @param:**

| Примитивные | Ссылочные | Коллекции |
|-------------|-----------|-----------|
| Строка | Справочник.* | Массив |
| Число | Документ.* | Структура |
| Дата | Перечисление.* | Соответствие |
| Булево | ПланСчетов.* | ТаблицаЗначений |
| Неопределено | Задача.* | ДеревоЗначений |
| NULL | БизнесПроцесс.* | СписокЗначений |

### @returns

Описание возвращаемого значения. Формат: `@returns {Тип} Описание`

```bsl
/// @returns {ТаблицаЗначений} Таблица графика платежей с колонками:
///   * Период - Дата платежа
///   * СуммаПлатежа - Общая сумма платежа
///   * ОсновнойДолг - Сумма погашения основного долга
///   * Проценты - Сумма процентов
///   * Остаток - Остаток задолженности
```

### @task

Ссылка на задачу в трекере. Обязательный тег для трассировки изменений.

```bsl
/// @task УЗ-12345
/// @task JIRA-567
/// @task BUG-890
```

## Рекомендуемые теги

### @throws

Описание исключений, которые может вызвать функция.

```bsl
/// @throws {ИсключениеДоговорНеНайден} Если договор не существует в базе
/// @throws {ИсключениеНекорректныеПараметры} Если параметры не прошли валидацию
/// @throws {ИсключениеПревышенЛимит} Если сумма превышает установленный лимит
```

### @example

Пример использования функции. Один из самых полезных тегов.

```bsl
/// @example
///   // Простой пример
///   Результат = ал_РасчётГрафика.РассчитатьГрафик(МойДоговор);
///
/// @example
///   // Пример с параметрами
///   Параметры = Новый Структура;
///   Параметры.Вставить("Срок", 24);
///   Параметры.Вставить("Ставка", 15.5);
///   Параметры.Вставить("ДатаНачала", ТекущаяДата());
///
///   График = ал_РасчётГрафика.РассчитатьГрафик(МойДоговор, Параметры);
///
///   Для Каждого Строка Из График Цикл
///       Сообщить(Строка.Период + ": " + Строка.СуммаПлатежа);
///   КонецЦикла;
```

### @since

Версия платформы, с которой доступна функция.

```bsl
/// @since 8.3.24
/// @since 8.3.20
```

### @author

Автор функции.

```bsl
/// @author Иванов А.С.
/// @author Петров И.В., Сидоров М.А.
```

### @tested

Статус тестирования.

```bsl
/// @tested да
/// @tested нет
/// @tested частично
```

### @coverage

Процент покрытия тестами.

```bsl
/// @coverage 95%
/// @coverage 78%
```

### @deprecated

Помечает функцию как устаревшую.

```bsl
/// @deprecated Используйте ал_НовыйМодуль.НоваяФункция() вместо этой
/// @deprecated С версии 8.3.24. Будет удалена в следующем релизе.
```

### @see

Ссылка на связанные функции/документацию.

```bsl
/// @see ал_РасчётГрафика.ПересчитатьГрафик
/// @see Документ.ДоговорЛизинга
```

### @private

Помечает функцию как приватную (не для внешнего использования).

```bsl
/// @private
/// @description Внутренняя функция для расчёта процентов
```

## Полный пример

```bsl
/// @description Рассчитывает график платежей по договору лизинга.
///              Алгоритм учитывает аннуитетную схему погашения с возможностью
///              указания отсрочки первого платежа.
///
/// @param {Справочник.ДоговорыЛизинга} Договор - Договор лизинга для расчёта.
///        Должен быть записан в базу (не новый).
///
/// @param {Структура} ПараметрыРасчета - Параметры расчёта графика:
///   * Срок - Число - Срок договора в месяцах (1-120)
///   * Ставка - Число - Годовая процентная ставка (0-100)
///   * ДатаНачала - Дата - Дата первого платежа
///   * Отсрочка - Число - Отсрочка первого платежа в днях (опционально, по умолчанию 0)
///   * СхемаПогашения - Строка - "Аннуитет" | "Дифференцированный" (опционально)
///
/// @returns {ТаблицаЗначений} Таблица графика платежей с колонками:
///   * НомерПлатежа - Число - Порядковый номер платежа
///   * ДатаПлатежа - Дата - Дата платежа
///   * СуммаПлатежа - Число - Общая сумма платежа
///   * ОсновнойДолг - Число - Сумма погашения основного долга
///   * Проценты - Число - Сумма процентов
///   * ОстатокДолга - Число - Остаток задолженности после платежа
///
/// @throws {ИсключениеДоговорНеЗаписан} Договор должен быть записан в базу
/// @throws {ИсключениеНекорректныйСрок} Срок должен быть от 1 до 120 месяцев
/// @throws {ИсключениеНекорректнаяСтавка} Ставка должна быть от 0 до 100%
///
/// @example
///   // Базовый пример использования
///   Параметры = Новый Структура;
///   Параметры.Вставить("Срок", 24);
///   Параметры.Вставить("Ставка", 15.5);
///   Параметры.Вставить("ДатаНачала", ДобавитьМесяц(ТекущаяДата(), 1));
///
///   График = ал_РасчётГрафика.РассчитатьГрафик(МойДоговор, Параметры);
///
///   // Вывод результата
///   Для Каждого Платёж Из График Цикл
///       Сообщить(СтрШаблон("Платёж %1: %2 руб. (%3)",
///           Платёж.НомерПлатежа,
///           Формат(Платёж.СуммаПлатежа, "ЧДЦ=2"),
///           Формат(Платёж.ДатаПлатежа, "ДФ=dd.MM.yyyy")));
///   КонецЦикла;
///
/// @example
///   // Пример с отсрочкой и дифференцированной схемой
///   Параметры = Новый Структура;
///   Параметры.Вставить("Срок", 36);
///   Параметры.Вставить("Ставка", 12);
///   Параметры.Вставить("ДатаНачала", '20250201');
///   Параметры.Вставить("Отсрочка", 30);
///   Параметры.Вставить("СхемаПогашения", "Дифференцированный");
///
///   График = ал_РасчётГрафика.РассчитатьГрафик(Договор, Параметры);
///
/// @since 8.3.24
/// @author Иванов А.С.
/// @task УЗ-12345
/// @tested да
/// @coverage 95%
/// @see ал_РасчётГрафика.ПересчитатьГрафик
/// @see ал_РасчётГрафика.ВалидироватьПараметры
Функция РассчитатьГрафик(Договор, ПараметрыРасчета) Экспорт
    // Реализация...
КонецФункции
```

## Минимальный пример

Для простых функций достаточно минимального набора тегов:

```bsl
/// @description Возвращает текущий курс валюты на дату
/// @param {Справочник.Валюты} Валюта - Валюта для получения курса
/// @param {Дата} Дата - Дата курса (по умолчанию текущая)
/// @returns {Число} Курс валюты
/// @task УЗ-12345
Функция ПолучитьКурсВалюты(Валюта, Дата = Неопределено) Экспорт
```

## Документирование процедур

Процедуры (без возвращаемого значения) документируются без `@returns`:

```bsl
/// @description Отправляет уведомление контрагенту по email
/// @param {Справочник.Контрагенты} Контрагент - Получатель уведомления
/// @param {Строка} Тема - Тема письма
/// @param {Строка} Текст - Текст письма (поддерживает HTML)
/// @throws {ИсключениеНетEmail} Если у контрагента не указан email
/// @task УЗ-67890
Процедура ОтправитьУведомление(Контрагент, Тема, Текст) Экспорт
```

## Документирование параметров-структур

Для сложных структур используйте вложенное описание:

```bsl
/// @param {Структура} НастройкиОтчёта - Настройки формирования отчёта:
///   * Период - Структура - Период отчёта:
///     ** НачалоПериода - Дата - Начало периода
///     ** КонецПериода - Дата - Конец периода
///   * Фильтры - Массив - Массив структур фильтров:
///     ** Поле - Строка - Имя поля для фильтрации
///     ** Оператор - Строка - Оператор сравнения ("=", ">", "<", "ПОДОБНО")
///     ** Значение - Произвольный - Значение для сравнения
///   * Группировки - Массив - Массив строк с именами полей группировки
///   * ВыводитьИтоги - Булево - Выводить итоговые строки
```

## Интеграция с инструментами

### BSL Language Server

BSL LS распознаёт jdocstring и использует для:
- Подсказок при наведении (hover)
- Автодополнения параметров
- Проверки соответствия документации коду

### SonarQube

SonarQube проверяет наличие jdocstring:
- Отсутствие документации = Code Smell
- Несоответствие параметров = Bug

## Checklist документирования

- [ ] Все экспортные функции имеют jdocstring
- [ ] @description заполнен и понятен
- [ ] Все параметры описаны с типами
- [ ] @returns описан для функций
- [ ] @task указан для трассировки
- [ ] @example добавлен для сложных функций
- [ ] @throws описаны для функций с исключениями
- [ ] @deprecated добавлен для устаревших функций
